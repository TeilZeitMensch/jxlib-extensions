/******************************************************************************
 * JxLib-Extensions - A JxLib UI Extension Library, .1-alpha 
 * Copyright (c) 2008-2009, Sola Gratia Designs. All rights reserved.
 * MIT Style License
 *****************************************************************************/
Jx.Request=new Class({Extends:Jx.Object,requests:[],requestCount:0,loadingVisible:false,errorHandlers:null,processRequests:true,running:false,options:{debug:false,showLoading:{el:null,opts:{baseHref:"",img:{src:"/images/load.gif",styles:{width:16,height:16}}}},url:null,method:"get",type:"json",update:null,evalScripts:true,evalResponse:false,data:{}},init:function(A){var D=$merge(this.options,A);this.requestCount++;var C=new Hash({requestId:this.requestCount,options:D});D.data.requestId=C.get("requestId");var B=null;if(D.type==="json"){B=new Request.JSON({url:D.url,data:D.data,onSuccess:this.processSuccess.bind(this),onFailure:(function(E){this.failure(E,C.get("requestId"))}).bind(this)})}else{if(D.type==="html"){B=new Request.HTML({url:D.url,update:D.update,data:D.data,evalScripts:D.evalScripts,onSuccess:(function(G,E,H,F){this.success(C.get("requestId"),[G,E,H,F])}).bind(this),onFailure:(function(E){this.failure(E,C.get("requestId"))}).bind(this)})}else{B=new Request({url:D.url,data:D.data,evalResponse:D.evalResponse,onSuccess:(function(E,F){this.success(C.get("requestId"),[E,F])}).bind(this),onFailure:this.failure.bind(this)})}}C.combine({request:B});return C},failure:function(A,D){var C=this.getRequest(D);var B=C.get("options");this.removeMask(B);if($defined(B.events)&&$defined(B.events.onFailure)){B.events.onFailure.run(A)}this.running=false;this.run()},success:function(D,A){var C=this.getRequest(D);var B=C.get("options");this.removeMask(C);this.running=false;this.run();if($defined(B.events)&&$defined(B.events.onSuccess)){B.events.onSuccess.run(A)}},callServer:function(E,B,A,F){if(!$defined(A)){A="bottom"}F=$defined(F)?F:false;var G;if($defined(E)){var C=$type(E);if(C!=="hash"){G=new Hash(E)}else{G=E}}else{if($type(B)==="hash"){if(!B.has("data")){G=new Hash()}else{G=B.get("data")}}else{G=new Hash()}}var D;if($type(B)!=="hash"){B.data=G;D=this.init(B);D.set("data",G)}else{D=B}D.combine({data:G});if(A==="top"){this.requests.unshift(D)}else{this.requests.push(D)}if(!F){this.run()}return D.get("requestId")},run:function(B){B=($defined(B))?B:false;if((!this.running&&this.processRequests&&(this.requests.length>0))||B){this.running=true;var D=this.currentRequest=this.requests.shift();var C=D.get("options");if(C.showLoading.el&&!D.has("waiter")){var A=new Spinner(C.showLoading.el,C.showLoading.opts);A.start();D.set("waiter",A)}else{if(C.showLoading.el&&D.has("waiter")){D.get("waiter").start()}}D.get("request").send()}},runOne:function(){this.run(true)},processSuccess:function(D,G){if($defined(D)){var C=this.currentRequest;var A=C.get("options");this.removeMask();this.running=false;this.run();try{if(A.debug&&$defined(D.debug)){if($defined(A.events)&&$defined(A.events.onDebug)){A.events.onDebug.run(D.debug)}}if(D.success){if($defined(A.events)&&$defined(A.events.onSuccess)){A.events.onSuccess.run(D)}}else{if(!this.handleError(D,C,A)){if($defined(A.events)&&$defined(A.events.onError)){A.events.onError.run(D)}}}}catch(B){var F="Error occurred: "+B.message;F+="<br/>in "+B.fileName;F+="<br/>at line "+B.lineNumber;F+="<br/>Stack Trace:<br/>"+B.stack;if($defined(Jx.Dialog.Message)){var E=new Jx.Dialog.Message({message:F,width:700,height:400,resize:true});E.open()}else{alert(F)}}}else{console.log(G)}},getRequest:function(B){var A=null;this.requests.each(function(C){if(C.get("requestId")===B){A=C}},this);if($defined(A)){this.requests.erase(A)}return A},removeMask:function(){if(this.currentRequest.has("waiter")){var A=this.currentRequest.get("waiter");A.stop();this.currentRequest.erase("waiter")}},handleError:function(F,E,D){if($defined(this.errorHandlers)){if($defined(F.error)){var C=F.error.code;var B=F.error.message;if(this.errorHandlers.has(C)){var A=this.errorHandlers.get(C);A.run([B,E]);this.removeMask(D);return true}}}return false},addErrorHandler:function(B,A){if(!$defined(this.errorHandlers)){this.errorHandlers=new Hash()}this.errorHandlers.set(B,A)},stop:function(){this.processRequests=false},start:function(){this.processRequests=true;this.run()}});Jx.Manager=new Class({Family:"Jx.Manager",Implements:[Options,Events],options:{type:"generic"},list:null,count:0,initialize:function(A){this.setOptions(A);this.list=new Hash();window.addEvent("unload",this.destroyAll.bind(this))},register:function(A){if($defined(A.options.id)){id=A.options.id}else{id=this._genId()}this.list.include(id,A);return id},destroy:function(A){if(this.list.has(A)){el=this.list.get(A);if($defined(el.destroy)&&$type(el.destroy)==="function"){el.destroy()}this.list.erase(A)}},destroyAll:function(){this.list.each(function(B,A){this.destroy(A)},this)},get:function(A){if(this.list.has(A)){return this.list.get(A)}else{return null}},_genId:function(){this.count++;return"jx-"+this.options.type+"-"+this.count}});Jx.StoreMgr=new Jx.Manager({type:"store"});Jx.Preloader=new Class({Family:"Jx.Preloader",Implements:[Events,Options],options:{onProgress:$empty,onComplete:$empty},counter:0,loadedCounter:0,picHash:null,sources:null,initialize:function(A,B){this.setOptions(A);this.picHash=new Hash();this.sources=new Hash();B.each(function(C){this.add(C.key,C.source)},this)},add:function(A,B){this.counter++;this.sources.include(A,B)},imageComplete:function(){this.loadedCounter++;this.fireEvent("progress",[this.counter,this.loadedCounter]);if(this.counter==this.loadedCounter){this.fireEvent("complete",[this.picHash])}},start:function(){this.fireEvent("progress",[this.counter,this.loadedCounter]);this.sources.each(function(C,B){var A=new Asset.image(C,{onload:this.imageComplete.bind(this)});this.picHash.include(B,A)},this)}});Jx.Editor=new Class({Family:"Jx.Editor",Extends:Jx.Widget,options:{template:'<div class="jxEditor"><div class="jxEditorToolbar"></div><div class="jxEditorIframe"></div><textarea class="jxEditorTextarea"></textarea></div></div>',editorCssFile:null,html:'<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body></body></html>',content:null,buttons:null,cleanup:true,xhtml:true,semantics:true,textareaName:"editor"},classes:$H({domObj:"jxEditor",container:"jxEditorToolbar",iframe:"jxEditorIframe",textarea:"jxEditorTextarea"}),pluginNamespace:"Editor",blockEls:/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD)$/i,init:function(){this.parent()},mode:null,keys:{},editorDisabled:false,toolbars:[],render:function(){this.parent();this.textarea.set("name",this.options.textareaName);var B=$splat(this.options.buttons).length;for(var A=0;A<B;A++){var E=new Jx.Toolbar.Container().addTo(this.container);this.toolbars.push(new Jx.Toolbar());E.add(this.toolbars[A])}if(this.options.parent){this.addTo(this.options.parent);new Jx.Layout(this.domObj)}this.domObj.resize();var D=this.iframe.getMarginBoxSize();var C=new IFrame({"class":"jxEditorIframe",src:'javascript:""',frameborder:0});C.replaces(this.iframe);this.iframe=C;this.mode="iframe";this.win=this.iframe.contentWindow;this.doc=this.win.document;this.doc.open();this.doc.write(this.options.html);this.doc.close();if(!this.win.$family){new Window(this.win)}if(!this.doc.$family){new Document(this.doc)}document.id(this.doc.body);if($defined(this.options.editorCssFile)){this.css=new Asset.css(this.options.editorCssFile,{title:"jxEditorStylesheet",onload:function(){}.bind(this)});this.css.inject(this.doc.head)}if($defined(this.options.content)){this.doc.body.set("html",this.options.content);this.textarea.set("value",this.options.content)}if(Browser.Engine.trident){this.doc.body.contentEditable=true}else{this.doc.designMode="On"}this.selection=new Jx.Editor.Selection(this.win);this.doc.addEvents({mouseup:this.editorMouseUp.bindWithEvent(this),mousedown:this.editorStopEvent.bindWithEvent(this,"MouseDown"),mouseover:this.editorStopEvent.bindWithEvent(this,"MouseOver"),mouseout:this.editorStopEvent.bindWithEvent(this,"MouseOut"),mouseenter:this.editorMouseEnter.bindWithEvent(this),mouseleave:this.editorStopEvent.bindWithEvent(this,"MouseLeave"),contextmenu:this.editorStopEvent.bindWithEvent(this,"ContextMenu"),click:this.editorClick.bindWithEvent(this),dblclick:this.editorStopEvent.bindWithEvent(this,"DoubleClick"),keypress:this.editorKeyPress.bindWithEvent(this),keyup:this.editorKeyUp.bindWithEvent(this),keydown:this.editorKeyDown.bindWithEvent(this),focus:this.editorFocus.bindWithEvent(this),blur:this.editorBlur.bindWithEvent(this)});this.win.addEvents({focus:this.editorFocus.bindWithEvent(this),blur:this.editorBlur.bindWithEvent(this)});["cut","copy","paste"].each(function(F){this.doc.body.addListener(F,this.editorStopEvent.bindWithEvent(this,F.capitalize()))},this);this.textarea.addEvent("keypress",this.textarea.retrieve("jx:textareaKeyListener",this.keyListener.bind(this)));if(Browser.Engine.gecko&&Browser.Engine.version==18){this.doc.addEvent("focus",function(){this.win.fireEvent("focus").focus()}.bind(this))}this.oldContent=this.getContent();this.domObj.store("Jx.Editor",this);this.resize();this.addEvent("postPluginInit",function(){this.options.buttons.each(function(G,F){this.options.plugins=G;this.toolbar=this.toolbars[F];this.initPlugins()},this)}.bind(this))},setContent:function(A){this.doc.body.set("html",A);return this},getContent:function(){return this.doc.body.get("html")},execute:function(C,B,A){if(this.busy){return }this.busy=true;this.doc.execCommand(C,B,A);this.saveContent();this.focus();this.busy=false;return false},toggleView:function(){this.fireEvent("preToggleView",this);if(this.mode==="textarea"){this.mode="iframe";this.iframe.setStyle("display","block");this.setContent(this.textarea.value);this.textarea.setStyle("display","none")}else{this.saveContent();this.mode="textarea";this.textarea.setStyle("display","block");this.iframe.setStyle("display","none")}this.fireEvent("postToggleView",this)},saveContent:function(){if(this.mode==="iframe"){this.textarea.set("value",this.cleanup(this.getContent()))}return this},resize:function(){var C=this.domObj.getContentBoxSize();var A=this.container.getMarginBoxSize();var B={width:C.width,height:C.height-A.height};this.iframe.setStyles(B);this.textarea.setStyles(B)},focus:function(){if(this.mode=="iframe"){this.win.focus()}else{this.textarea.focus()}this.fireEvent("focus",this);return this},editorStopEvent:function(B,A){if(this.editorDisabled){B.stop();return }this.fireEvent("editor"+A,[B,this])},editorFocus:function(A){this.oldContent="";this.fireEvent("editorFocus",[A,this])},editorBlur:function(A){this.oldContent=this.saveContent().getContent();this.fireEvent("editorBlur",[A,this])},editorMouseUp:function(A){if(this.editorDisabled){A.stop();return }this.checkStates();this.fireEvent("editorMouseUp",[A,this])},editorMouseEnter:function(A){if(this.editorDisabled){A.stop();return }if(this.oldContent&&this.getContent()!=this.oldContent){this.focus();this.fireEvent("editorPaste",[A,this])}this.fireEvent("editorMouseEnter",[A,this])},editorClick:function(B){if(Browser.Engine.webkit){var A=$(B.target);if(A.get("tag")=="img"){this.selection.selectNode(A)}}this.fireEvent("editorClick",[B,this])},editorKeyPress:function(A){if(this.editorDisabled){A.stop();return }this.keyListener(A);this.fireEvent("editorKeyPress",[A,this])},editorKeyUp:function(A){if(this.editorDisabled){A.stop();return }var B=A.code;if(/^enter|left|up|right|down|delete|backspace$/i.test(A.key)||(B>=33&&B<=36)||B==45||A.meta||A.control){if(Browser.Engines.trident4){$clear(this.checkStateDelay);this.checkStatesDelay=this.checkStates.delay(500,this)}else{this.checkStates()}}this.fireEvent("editorKeyUp",[A,this])},editorKeyDown:function(F){if(this.editorDisabled){F.stop();return }if(F.key=="enter"){if(F.shift&&Browser.Engine.webkit){var J=this.selection;var A=J.getRange();var I=this.doc.createElement("br");A.insertNode(I);A.setStartAfter(I);A.setEndAfter(I);J.setRange(A);if(J.getSelection().focusNode==I.previousSibling){var H=this.doc.createTextNode("\u00a0");var B=I.parentNode;var G=I.nextSibling;(G)?B.insertBefore(H,G):B.appendChild(H);J.selectNode(H);J.collapse(1)}this.win.scrollTo(0,Element.getOffsets(J.getRange().startContainer).y);F.preventDefault()}else{if(Browser.Engine.gecko||Browser.Engine.webkit){var D=this.selection.getNode();var C=D.getParents().include(D).some(function(K){return K.nodeName.test(this.blockEls)}.bind(this));if(!C){this.execute("insertparagraph",false,false)}}}}else{if(Browser.Engine.trident){var A=this.selection.getRange();var D=this.selection.getNode();if(A&&D.get("tag")!="li"){this.selection.insertContent("<br>");this.selection.collapse(false)}F.preventDefault()}}if(Browser.Engine.presto){var E=F.control||F.meta;if(E&&F.key=="x"){this.fireEvent("editorCut",[F,this])}else{if(E&&F.key=="c"){this.fireEvent("editorCopy",[F,this])}else{if((E&&F.key=="v")||(F.shift&&F.code==45)){this.fireEvent("editorPaste",[F,this])}}}}this.fireEvent("editorKeyDown",[F,this])},keyListener:function(C){var A=(Browser.Platform.mac)?C.meta:C.control;if(!A||!this.keys[C.key]){return }C.preventDefault();var B=this.keys[C.key];B.command();if(this.mode=="iframe"){this.checkStates()}},checkStates:function(){var A=this.selection.getNode();if(!A){return }if(Jx.type(A)!="element"){return }this.plugins.each(function(B){if($defined(B.checkState)){B.checkState(A)}},this)},cleanup:function(B){if(!this.options.cleanup){return B.trim()}do{var A=B;B=B.replace(/<br class\="webkit-block-placeholder">/gi,"<br />");B=B.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1");B=B.replace(/ class="Apple-style-span"/gi,"");B=B.replace(/<span style="">/gi,"");B=B.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>");B=B.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>");if(!this.options.semantics){B=B.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")}if(this.options.xhtml){B=B.replace(/<br>/gi,"<br />")}if(this.options.semantics){if(Browser.Engine.trident){B=B.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")}if(Browser.Engine.webkit){B=B.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>");B=B.replace(/<div>(.+?)<\/div>/ig,"<p>$1</p>")}if(["gecko","presto","webkit"].contains(Browser.Engine.name)){B=B.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>");B=B.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")}B=B.replace(/<br[^>]*><\/p>/g,"</p>");B=B.replace(/<p>\s*(<img[^>]+>)\s*<\/p>/ig,"$1\n");B=B.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n");B=B.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n");B=B.replace(/><li>/g,">\n\t<li>");B=B.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>");B=B.replace(/([^\n])<img/ig,"$1\n<img");B=B.replace(/^\s*$/g,"")}B=B.replace(/<br ?\/?>$/gi,"");B=B.replace(/^<br ?\/?>/gi,"");B=B.replace(/><br ?\/?>/gi,">");B=B.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1");B=B.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>");B=B.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>");B=B.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");B=B.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");B=B.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>');B=B.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1");B=B.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1");B=B.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1");B=B.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1");B=B.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1");B=B.replace(/<[^> ]*/g,function(C){return C.toLowerCase()});B=B.replace(/<[^>]*>/g,function(C){C=C.replace(/ [^=]+=/g,function(D){return D.toLowerCase()});return C});B=B.replace(/<[^>]*>/g,function(C){C=C.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return C});if(this.options.xhtml){B=B.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")}B=B.replace(/<p>(?:\s*)<p>/g,"<p>");B=B.replace(/<\/p>\s*<\/p>/g,"</p>");B=B.replace(/<pre[^>]*>.*?<\/pre>/gi,function(C){return C.replace(/<br ?\/?>/gi,"\n")});B=B.trim()}while(B!=A);return B},enableToolbar:function(){this.plugins.each(function(A){A.setEnabled(true)},this)},disableToolbar:function(){this.plugins.each(function(A){A.setEnabled(false)},this)}});Jx.Editor.Selection=new Class({Family:"Jx.Editor.Selection",Extends:Jx.Object,parameters:["win","options"],options:{},init:function(){this.parent();this.win=this.options.win},getSelection:function(){this.win.focus();return(this.win.getSelection)?this.win.getSelection():this.win.document.selection},getRange:function(){var A=this.getSelection();if(!A){return null}try{return A.rangeCount>0?A.getRangeAt(0):(A.createRange?A.createRange():null)}catch(B){return this.doc.body.createTextRange()}},setRange:function(A){if(A.select){$try(function(){A.select()})}else{var B=this.getSelection();if(B.addRange){B.removeAllRanges();B.addRange(A)}}},selectNode:function(C,D){var B=this.getRange();var A=this.getSelection();if(B.moveToElementText){$try(function(){B.moveToElementText(C);B.select()})}else{if(A.addRange){D?B.selectNodeContents(C):B.selectNode(C);A.removeAllRanges();A.addRange(B)}else{A.setBaseAndExtent(C,0,C,1)}}return C},isCollapsed:function(){var A=this.getRange();if(A.item){return false}return A.boundingWidth==0||this.getSelection().isCollapsed},collapse:function(A){var C=this.getRange();var B=this.getSelection();if(C.select){C.collapse(A);C.select()}else{A?B.collapseToStart():B.collapseToEnd()}},getContent:function(){var C=this.getRange();var A=new Element("body");if(this.isCollapsed()){return""}if(C.cloneContents){A.appendChild(C.cloneContents())}else{if($defined(C.item)||$defined(C.htmlText)){A.set("html",C.item?C.item(0).outerHTML:C.htmlText)}else{A.set("html",C.toString())}}var B=A.get("html");return B},getText:function(){var B=this.getRange();var A=this.getSelection();return this.isCollapsed()?"":B.text||(A.toString?A.toString():"")},getNode:function(){var B=this.getRange();if(!Browser.Engine.trident){var A=null;if(B){A=B.commonAncestorContainer;if(!B.collapsed){if(B.startContainer==B.endContainer){if(B.startOffset-B.endOffset<2){if(B.startContainer.hasChildNodes()){A=B.startContainer.childNodes[B.startOffset]}}}}while($type(A)!="element"){A=A.parentNode}}return document.id(A)}return document.id(B.item?B.item(0):B.parentElement())},insertContent:function(B){if(Browser.Engine.trident){var A=this.getRange();A.pasteHTML(B);A.collapse(false);A.select()}else{this.win.document.execCommand("insertHTML",false,B)}}});Jx.Panel.Form=new Class({Family:"Jx.Panel.Form",Extends:Jx.Panel,notices:$H(),options:{fields:null,validators:null,notifierType:"inline",formOptions:null},init:function(){this.parent()},render:function(){this.form=new Jx.Form(this.options.formOptions);if(this.options.notifierType==="inline"){this.notifier=new Jx.Notifier({parent:$(this.form)})}else{this.notifier=new Jx.Notifier.Float({parent:document.body})}this.addFields(this.form,this.options.fields);this.options.content=$(this.form);this.parent();if($defined(this.options.validators)){this.validator=new Jx.Plugin.Form.Validator(this.options.validators);this.validator.attach(this.form);this.validator.addEvents({fieldValidationFailed:this.fieldFailed.bind(this),fieldValidationPassed:this.fieldPassed.bind(this)})}},addFields:function(A,B){B.each(function(D){var C=Jx.type(D);if(C==="element"){D.inject($(this.form))}else{if(D instanceof Jx.Widget){D.addTo(this.form)}else{if(C==="object"&&$defined(D.type)){if(D.type.toLowerCase()==="fieldset"){var E=new Jx.Fieldset(D.options);A.add(E);if($defined(D.children)){this.addFields(E,D.children)}}else{var E=new Jx.Field[D.type.capitalize()](D.options);A.add(E)}}}}},this)},fieldPassed:function(B,A){if(this.notices.has(B.id)){this.notices.get(B.id).close()}},fieldFailed:function(D,B){var A=B.getErrors();var E=D.name+" has the following errors: "+A.join(",")+".";var C=new Jx.Notice.Error({content:E,onClose:function(){this.notices.erase(D.id)}.bind(this)});this.notifier.add(C);this.notices.set(D.id,C)}});Jx.Dialog.Wizard=new Class({Extends:Jx.Dialog,options:{resize:false,collapse:false,maximize:false,minimize:false,width:400,height:400,validateOn:"steps",allowFinish:"last",showSteps:true,hideSteps:false,steps:[]},stepDefaults:{title:null,content:null,next:null},steps:[],stepIndex:0,render:function(){toolbar=new Jx.Toolbar({position:"bottom"});this.prev=new Jx.Button({label:"Previous",image:Jx.aPixel.src,imageClass:"jxWizardPrev",onClick:this.previousStep.bind(this)});this.next=new Jx.Button({label:"Next",image:Jx.aPixel.src,imageClass:"jxWizardNext",onClick:this.nextStep.bind(this)});this.cancel=new Jx.Button({label:"Cancel",image:Jx.aPixel.src,imageClass:"jxWizardCancel",onClick:this.close.bind(this)});this.finish=new Jx.Button({label:"Finish",image:Jx.aPixel.src,imageClass:"jxWizardFinish",onClick:this.finishWizard.bind(this)});toolbar.add(this.prev,this.next,this.cancel,this.finish);this.addEvent("close",this.onCancel.bind(this));this.options.toolbars=[toolbar];if(!$defined(this.options.parent)){this.options.parent=document.body}this.parent(this.options);this.domObj.addClass("jxWizard");if(this.options.showSteps){this.split=new Jx.Splitter(this.content,{splitInto:2,layout:"horizontal",barOptions:[{snap:"before"}],containerOptions:[{width:150}]});this.list=new Jx.ListView({select:true});var A=this.options.steps.length;this.list.list.addEvent("select",this.gotoStep.bind(this));this.list.list.empty();var B="<li class='jxListItemContainer jxWizardStep'><a class='jxListItem' href='javascript:void(0);'><img src='"+Jx.aPixel.src+"' class='itemImg jxWizardStepImage'><span class='itemLabel'>{name}</span></a></li>";this.options.steps.each(function(F,D){var G={};G.name="Step "+(D+1)+" of "+A+" : "+F.title;var C=new String(B).substitute(G);var E=new Jx.ListItem({template:C,enabled:true});$(E).store("stepIndex",D);this.list.add(E);F.listItem=E},this);this.list.addTo(this.split.elements[0]);this.tabSet=new Jx.TabSet(this.split.elements[1])}else{this.tabSet=new Jx.TabSet(this.content)}this.options.steps.each(function(F){var E=$merge(this.stepDefaults,F);var C=$type(F.content);var D;if($defined(C)){switch(C){case"string":D=new Jx.Button.Tab({content:$(F.content)});break;case"element":D=new Jx.Button.Tab({content:F.content});break;case"object":if($defined(F.content.domObj)){D=new Jx.Button.Tab({content:F.content.domObj})}else{if($defined(F.content.buttons)){F.content.buttons=null}if($defined(F.content.toolbars)){F.content.toolbars=null}f=new Jx.Panel.Form(F.content);F.form=f;D=new Jx.Button.Tab({content:$(f)})}break}F.tab=D;this.steps.include(F);this.tabSet.add(D)}},this);$(this.content).addClass("jxWizard");if(this.options.hideSteps){this.split.bars[0].fireEvent("dblclick")}this.tabSet.setActiveTab(this.steps[0].tab);this.enableButtons()},previousStep:function(){var A;if($defined(this.steps[this.stepIndex].previous)){A=this.steps[this.stepIndex].previous;if(Jx.type(A)==="function"){A=A.apply(this)}}else{A=this.stepIndex-1}this.changeSteps(A)},nextStep:function(){if(this.isFormValid()){var A;if($defined(this.steps[this.stepIndex].next)){A=this.steps[this.stepIndex].next;if(Jx.type(A)==="function"){A=A.apply(this)}}else{A=this.stepIndex+1}this.changeSteps(A)}},onCancel:function(){this.fireEvent("cancel")},finishWizard:function(){var B=true;var C=new Hash();var A=-1;this.steps.each(function(E,D){if($defined(E.form)){if(E.form.form.isValid()){C.extend(E.form.form.getValues())}else{B=false;if(A===-1){A=D}}}},this);if(B){this.close();this.fireEvent("finish",C)}else{this.changeSteps(A)}},gotoStep:function(B){if(this.isFormValid()){var A=$(B).retrieve("stepIndex");this.changeSteps(A)}},changeSteps:function(A){this.stepIndex=A;this.steps[this.stepIndex].tab.setActive(true);this.enableButtons();this.fireEvent("showStep",[this,this.stepIndex])},isFormValid:function(){if(this.options.validateOn==="steps"){if($defined(this.steps[this.stepIndex].form)&&$defined(this.steps[this.stepIndex].form.form)){return this.steps[this.stepIndex].form.form.isValid()}}return true},enableButtons:function(){if(this.stepIndex===0&&(this.steps.length>1)){this.prev.setEnabled(false);this.next.setEnabled(true)}else{if(this.steps.length==1){this.prev.setEnabled(false);this.next.setEnabled(false)}else{if(this.stepIndex===(this.steps.length-1)){this.prev.setEnabled(true);this.next.setEnabled(false)}else{this.prev.setEnabled(true);this.next.setEnabled(true)}}}if(this.options.allowFinish==="all"||(this.options.allowFinish==="last"&&(this.stepIndex===(this.steps.length-1)))){this.finish.setEnabled(true)}else{this.finish.setEnabled(false)}}});Jx.ChromePanel=new Class({Family:"Jx.ChromePanel",Extends:Jx.Panel,options:{resize:true},init:function(){this.addEvents({expand:function(){this.showChrome(this.domObj);this.options.closed=false;if(this.resizeHandle){this.resizeHandle.setStyle("display","block")}}.bind(this),collapse:function(){var A=this.domObj.measure(function(){return this.getSizes(["margin"],["top","bottom"]).margin});var B=this.title.getMarginBoxSize();this.domObj.resize({height:A.top+B.height+(A.bottom*2)});this.options.closed=true;this.showChrome(this.domObj);if(this.resizeHandle){this.resizeHandle.setStyle("display","none")}}.bind(this),addTo:function(){this.showChrome(this.domObj)}.bind(this),sizeChange:function(){this.showChrome(this.domObj)}.bind(this)});this.parent()},render:function(){this.parent();this.title.removeClass("jxPanelTitle").addClass("jxDialogTitle");this.domObj.removeClass("jxPanel").addClass("jxDialog");this.domImg.removeClass("jxPanelIcon").addClass("jxDialogIcon");this.domLabel.removeClass("jxPanelLabel").addClass("jxDialogLabel");this.domControls.removeClass("jxPanelControls").addClass("jxDialogControls");this.contentContainer.removeClass("jxPanelContentContainer").addClass("jxDialogContentContainer");this.content.removeClass("jxPanelContent").addClass("jxDialogContent");this.showChrome(this.domObj);if(this.options.resize&&typeof Drag!="undefined"){this.resizeHandle=new Element("div",{"class":"jxDialogResize",title:this.options.resizeTooltip,styles:{display:this.options.closed?"none":"block"}});this.domObj.appendChild(this.resizeHandle);this.resizeHandleSize=this.resizeHandle.getSize();this.resizeHandle.setStyles({bottom:this.resizeHandleSize.height,right:this.resizeHandleSize.width});this.domObj.makeResizable({handle:this.resizeHandle,modifiers:{x:null,y:"height"},onStart:(function(){this.contentContainer.setStyle("visibility","hidden");this.chrome.addClass("jxChromeDrag")}).bind(this),onDrag:(function(){this.resizeChrome(this.domObj)}).bind(this),onComplete:(function(){this.chrome.removeClass("jxChromeDrag");var A=this.domObj.getMarginBoxSize();this.options.width=A.width;this.options.height=A.height;this.layoutContent();this.domObj.resize(this.options);this.contentContainer.setStyle("visibility","");this.fireEvent("resize");this.resizeChrome(this.domObj);this.domObj.setStyle("position","relative")}).bind(this)})}}});Jx.Layout.Columns=new Class({Family:"Jx.Layout.Columns",Extends:Jx.Object,options:{columns:[{cssClass:"",width:"30%",items:null},{cssClass:"",width:"*",items:null},{cssClass:"",width:"25%",items:null}],addDefaults:{isDraggable:true,column:1,position:"top"},dragDefaults:{dropZoneClass:"jxDropZone",handle:"",position:"bottom",isDraggable:true}},parameters:["target","options"],columns:[],marker:null,target:null,widgets:$H(),init:function(){this.parent();this.target=$(this.options.target);this.target.addClass("jxLayoutColumns");this.marker=new Element("div",{"class":"jxLayoutColumnMarker"}).setStyles({opacity:0.7,visibility:"hidden"}).inject(document.getElement("body"));var A=0;this.options.columns.each(function(C,B){var D=new Element("div",{"class":"jxLayoutColumn"});D.addClass(C.cssClass);D.addClass(this.options.dragDefaults.dropZoneClass);if(B==this.options.columns.length-1){D.addClass("jxLayoutColumnLast")}D.inject(this.target);this.columns.push(D)},this);this.options.columns.each(function(C,B){if($defined(C.items)){this.add(C.items,{column:B})}else{this.addPlaceholder(B)}},this);this.windowResize();window.addEvent("resize",this.windowResize.bind(this));window.addEvent("load",this.windowResize.bind(this))},addPlaceholder:function(A){var B=new Element("div",{"class":"jxLayoutPlaceholder"});this.add(B,{column:A,isDraggable:false});this.columns[A].store("placeholder",B)},windowResize:function(){var B=this.target.getContentBoxSize();B.width-=50;var A=0;this.options.columns.each(function(F,E){var H=this.columns[E];if(F.width=="*"){this.fluidCol=H}else{if(F.width.contains("%")){var I=F.width.toInt();var K=H.getStyle("margin-right").toInt();var J=H.getStyle("margin-left").toInt();H.setStyle("width",(B.width*I/100)-K-J)}else{H.setStyle("width",F.width)}var G=H.getMarginBoxSize();A+=G.width}},this);if($defined(this.fluidCol)){var D=this.fluidCol.getStyle("margin-right").toInt();var C=this.fluidCol.getStyle("margin-left").toInt();this.fluidCol.setStyle("width",B.width-A-D-C)}this.resize()},add:function(B,A){A=$merge(this.options.addDefaults,A);$splat(B).each(function(E){E=$(E);var C=$(this.columns[A.column]);var D=C.getChildren();var F;D.each(function(H,G){if(G+1==A.position){F=H}},this);if(E.addTo){if(!$defined(F)){E.addTo(C,"bottom")}else{E.addTo(F,"after")}}else{if(!$defined(F)){E.inject(C,"bottom")}else{E.inject(F,"after")}}if(!E.hasClass("jxLayoutPlaceholder")){C.getChildren(".jxLayoutPlaceholder").each(function(G){G.dispose()},this)}this.widgets.set(E.get("id"),E);if($defined(E.resize)){E.resize()}E.setStyle("position","relative")},this);if(A.isDraggable){this.makeDraggable(B,A.handle)}this.fireEvent("jxLayoutColumnAdd")},makeDraggable:function(A,B){B=$defined(B)?B:this.options.dragDefaults.handle;$splat(A).each(function(C){C=$(C);C.addClass("jxLayoutDraggable");C.makeDraggable({droppables:$$("."+this.options.dragDefaults.dropZoneClass),handle:C.getElement(B),precalculate:false,onBeforeStart:function(){var E=C.getCoordinates(C.getParent());var D=C.getParent();if(D.getChildren().length==1){D.retrieve("placeholder").inject(D,"bottom")}this.marker.setStyles({display:"block",visibility:"visible",height:E.height,width:E.width-5}).inject(C,"after");C.setStyles({position:"absolute",top:(E.top-C.getStyle("margin-top").toFloat()),left:(E.left-C.getStyle("margin-left").toFloat()),width:E.width,opacity:0.7,"z-index":3})}.bind(this),onEnter:function(E,D){D.adopt(this.marker.setStyles({display:"block",height:E.getCoordinates().height,width:D.getCoordinates().width-5}));var F=D.retrieve("placeholder");if(D.hasChild(F)){F.dispose()}}.bind(this),onLeave:function(F,D){this.marker.dispose();var G=D.retrieve("placeholder");var E=D.getChildren();E=E.filter(function(H){return H!=G&&H!=F},this);if(E.length==0){G.inject(D,"top")}}.bind(this),onDrag:function(E){target=null;drop=this.marker.getParent();var D=E.retrieve("dragger");if(drop&&drop.getChildren().length>1){var F=drop.retrieve("placeholder");if(drop.hasChild(F)){F.dispose()}kids=drop.getChildren();mouseY=D.mouse.now.y;kids.each(function(G){if(mouseY>(G.getCoordinates().top+Math.round(G.getCoordinates().height/2))){target=G}});if(target==null){if(kids[0]!=this.marker){this.marker.inject(drop,"top")}}else{if((target!=this.marker)&&(target!=this.marker.getPrevious())){this.marker.inject(target,"after")}}}}.bind(this),onDrop:function(E,D){if(D){E.setStyles({position:"relative",top:"0",left:"0",width:"auto",opacity:1,"z-index":1}).replaces(this.marker);if($defined(E.resize)){E.resize({width:null})}if(D.hasChild(D.retrieve("placeholder"))){$(D.retrieve("placeholder")).dispose()}}else{E.setStyles({position:"relative",top:"0",left:"0",opacity:1,"z-index":1});console.log("drop not in zone")}}.bind(this),onComplete:function(D){this.marker.dispose();D.setStyle("position","relative");this.fireEvent("jxLayoutMoveComplete",D)}.bind(this),onCancel:function(D){this.marker.dispose();D.setStyles({position:"relative",top:"0",left:"0",width:null,opacity:1,"z-index":1})}.bind(this)})},this)},resize:function(){this.widgets.each(function(A){A=$(A);if($defined(A.resize)){A.resize()}},this)},serialize:function(){var A=[];this.columns.each(function(C,B){C.getChildren().each(function(F,E){F=$(F);if(!F.hasClass("jxLayoutPlaceholder")){var D=F.getBorderBoxSize();A.push({id:F.get("id"),width:D.width,height:D.height,column:B,position:E})}},this)},this);return A}});Jx.Adapter=new Class({Family:"Jx.Adapter",Extends:Jx.Object,options:{template:"",useTemplate:true},parameters:["store","widget","options"],init:function(){this.parent();this.widget=this.options.widget;this.store=this.options.store;if(this.options.useTemplate){this.columnsNeeded=this.parseTemplate()}},parseTemplate:function(){var B=this.store.getColumns();var A=[];B.each(function(C){var D="{"+C.name+"}";if(this.options.template.contains(D)){A.push(C.name)}},this);return A}.protect(),fillTemplate:function(B){var A={};this.columnsNeeded.each(function(C){A[C]=this.store.get(C,B)},this);return this.options.template.substitute(A)}.protect(),fill:$empty});Jx.Adapter.Tree=new Class({Family:"Jx.Adapter.Tree",Extends:Jx.Adapter,Binds:["fill","checkFolder"],options:{useAjax:false,startingNodeKey:0,folderOptions:{image:null,imageClass:null},itemOptions:{image:null,imageClass:null}},folders:new Hash(),currentRecord:0,init:function(){this.parent();this.tree=this.widget;this.tree.addEvent("disclose",this.checkFolder);if(this.options.useAjax){this.strategy=this.store.getStrategy("progressive");if(!$defined(this.strategy)){this.strategy=new Jx.Store.Strategy.Progressive({dropRecords:false,getPaginationParams:function(){return{}}});this.store.addStrategy(this.strategy)}else{this.strategy.options.dropRecords=false;this.strategy.options.getPaginationParams=function(){return{}}}}this.store.addEvent("storeDataLoaded",this.fill);this.store.load({node:this.options.startingNodeKey})},fill:function(){var A=this.store.count()-1;for(var B=this.currentRecord;B<=A;B++){var C=this.fillTemplate(B);var E;if(this.hasChildren(B)){var E=new Jx.TreeFolder($merge(this.options.folderOptions,{label:C}));this.folders.set(B,E)}else{var E=new Jx.TreeItem($merge(this.options.itemOptions,{label:C}))}$(E).store("index",B);$(E).store("jxAdapter",this);if(this.hasParent(B)){var F=this.getParentIndex(B);var D=this.folders.get(F);D.add(E)}else{this.tree.add(E)}}this.currentRecord=A},checkFolder:function(B){var A=B.items();if(!$defined(A)||A.length===0){this.store.load({node:$(B).retrieve("index")})}},hasChildren:$empty,hasParent:$empty,getParentIndex:$empty});Jx.Adapter.Tree.Mptt=new Class({Family:"Jx.Adapter.Tree.Mptt",Extends:Jx.Adapter.Tree,options:{left:"left",right:"right"},hasChildren:function(B){var A=this.store.get(this.options.left,B).toInt();var C=this.store.get(this.options.right,B).toInt();return(A+1!==C)},hasParent:function(A){var B=this.getParentIndex(A);if($defined(B)){return true}return false},getParentIndex:function(B){var A=this.store.get(this.options.left,B).toInt();var E=this.store.get(this.options.right,B).toInt();for(var C=B-1;C>=0;C--){var D=this.store.get(this.options.left,C).toInt();var F=this.store.get(this.options.right,C).toInt();if(D<A&&F>E){return C}}return null}});Jx.Adapter.Tree.Parent=new Class({Family:"Jx.Adapter.Tree.Parent",Extends:Jx.Adapter.Tree,options:{parentColumn:"parent",folderColumn:"folder"},hasChildren:function(A){if(this.options.useAjax){return this.store.get(this.options.folderColumn,A)}else{var C=this.store.get("primaryKey",A);for(var B=0;B<this.store.count();B++){if(this.store.get(this.options.parentColumn,B)===C){return true}}return false}},hasParent:function(A){if(this.store.get(this.options.parentColumn,A).toInt()!==-1){return true}return false},getParentIndex:function(A){var B=this.store.get(this.options.parentColumn,A);return this.store.findByColumn("primaryKey",B)}});Jx.Plugin.Editor={};Jx.Plugin.Editor.Button=new Class({Family:"Jx.Plugin.Editor.Button",Extends:Jx.Plugin,options:{image:"",toggle:false,shortcut:null,title:null,imageClass:"",prefix:"jxEditorButton"},tags:null,css:null,action:null,attach:function(A){this.editor=A;this.selection=A.selection;this.parent(A);this.button=new Jx.Button({toggle:this.options.toggle,image:this.options.image,imageClass:this.options.prefix+this.options.imageClass,tooltip:this.options.title+($defined(this.options.shortcut)?"(ctrl-"+this.options.shortcut+")":"")});this.editor.toolbar.add(this.button);if(this.options.toggle){this.button.addEvents({down:this.command.bind(this),up:this.command.bind(this)})}else{this.button.addEvent("click",this.command.bind(this))}this.editor.keys[this.options.shortcut]=this},detach:function(){this.button.destroy();this.parent(editor)},setState:function(A){if(this.options.toggle){this.settingState=true;this.button.setActive(A)}this.settingState=false},getState:function(){if(this.options.toggle){return this.button.isActive()}return false},checkState:function(C){this.setState(false);if($defined(this.action)){try{if(this.editor.doc.queryCommandState(this.action)){this.setState(true);return }}catch(E){}}if($defined(this.tags)){var D=C;do{var A=D.tagName.toLowerCase();if(this.tags.contains(A)){this.setState(true);break}}while((D.tagName.toLowerCase()!="body")&&((D=Element.getParent(D))!=null))}if($defined(this.css)){var D=C;do{found=false;for(var F in this.css){var B=this.css[F];if(Element.getStyle(D,F).contains(B)){this.setState(true);found=true}}if(found||D.tagName.test(this.editor.blockEls)){break}}while((D.tagName.toLowerCase()!="body")&&((D=Element.getParent(D))!=null))}},command:function(){if(!this.settingState){this.editor.execute(this.action,false,false)}},setEnabled:function(A){this.button.setEnabled(A)}});Jx.Plugin.Editor.Bold=new Class({Family:"Jx.Plugin.Editor.Bold",Extends:Jx.Plugin.Editor.Button,name:"bold",options:{image:Jx.aPixel.src,imageClass:"Bold",toggle:true,shortcut:"b",title:"Bold"},tags:["b","strong"],css:{"font-weight":"bold"},action:"bold",init:function(){this.parent();this.bound={setup:this.setup.bind(this),parse:this.setup.bind(this)}},attach:function(A){this.parent(A);this.editor.addEvent("preToggleView",this.bound.parse);this.editor.addEvent("postPluginInit",this.bound.setup)},setup:function(){var A=this.parse();if(A){this.editor.setContent(A)}this.editor.removeEvent("postPluginInit",this.bound.setup)},parse:function(){if(Browser.Engine.gecko){var A=this.editor.textarea.get("value");A.replace(/<strong([^>]*)>/gi,"<b$1>");A.replace(/<\/strong>/gi,"</b>");this.editor.textarea.set("html",A);return A}return null}});Jx.Plugin.Editor.Italic=new Class({Family:"Jx.Plugin.Editor.Italic",Extends:Jx.Plugin.Editor.Button,name:"italic",options:{image:Jx.aPixel.src,imageClass:"Italic",toggle:true,shortcut:"i",title:"Italic"},tags:["i","em"],css:{"font-style":"italic"},action:"italic",init:function(){this.parent();this.bound={setup:this.setup.bind(this),parse:this.setup.bind(this)}},attach:function(A){this.parent(A);this.editor.addEvent("preToggleView",this.bound.parse);this.editor.addEvent("postPluginInit",this.bound.setup)},setup:function(){var A=this.parse();if(A){this.editor.setContent(A)}this.editor.removeEvent("postPluginInit",this.bound.setup)},parse:function(){if(Browser.Engine.gecko){var A=this.editor.textarea.get("value").replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");this.editor.textarea.set("value",A);return A}return null}});Jx.Plugin.Editor.Underline=new Class({Family:"Jx.Plugin.Editor.Underline",Extends:Jx.Plugin.Editor.Button,name:"underline",options:{image:Jx.aPixel.src,imageClass:"Underline",toggle:true,shortcut:"u",title:"Underline"},tags:["u"],css:{"text-decoration":"underline"},action:"underline"});Jx.Plugin.Editor.Separator=new Class({Family:"Jx.Plugin.Editor.Separator",Extends:Jx.Plugin,name:"separator",attach:function(A){this.button=new Jx.Toolbar.Separator();A.toolbar.add(this.button)}});Jx.Plugin.Editor.ButtonSet=new Class({Family:"Jx.Plugin.Editor.ButtonSet",Extends:Jx.Plugin,options:{buttons:null},buttonSet:null,buttons:[],prefix:"jxEditorButton",init:function(){this.parent();this.buttonSet=new Jx.ButtonSet()},attach:function(A){this.parent(A);this.editor=A;$H(this.options.buttons).each(function(B,D){var C=new Jx.Button({toggle:true,image:B.image,imageClass:this.prefix+B.imageClass,tooltip:B.title});this.editor.toolbar.add(C);this.buttons.push(C);this.buttonSet.add(C);C.action=D;C.addEvents({down:this.command.bind(this,D),up:this.command.bind(this,D)})},this)},detach:function(){this.parent()},checkState:function(A){this.buttons.each(function(D){this.setState(false,D);if($defined(D.action)){try{if(this.editor.doc.queryCommandState(D.action)){this.setState(true,D);return }}catch(F){}}if($defined(D.options.tags)){var E=A;do{var B=E.tagName.toLowerCase();if(D.options.tags.contains(B)){this.setState(true,D);break}}while((E=Element.getParent(E))!=null)}if($defined(D.options.css)){var E=A;do{found=false;for(var G in D.options.css){var C=D.options.css[G];if(Element.getStyle(E,G).contains(C)){this.setState(true,D);found=true}}if(found||E.tagName.test(this.editor.blockEls)){break}}while((E=A.getParent(E))!=null)}},this)},setState:function(B,A){this.settingState=true;A.setActive(B);this.settingState=false},command:function(A){if(!this.settingState){this.editor.execute(A,false,false)}},setEnabled:function(A){this.buttons.each(function(B){B.setEnabled(A)},this)}});Jx.Plugin.Editor.Alignment=new Class({Family:"Jx.Plugin.Editor.Aligmment",Extends:Jx.Plugin.Editor.ButtonSet,name:"alignment",options:{buttons:{justifyleft:{image:Jx.aPixel.src,imageClass:"JustifyLeft",title:"Align Left",css:{"text-align":"left"}},justifyright:{image:Jx.aPixel.src,imageClass:"JustifyRight",title:"Align Right",css:{"text-align":"right"}},justifycenter:{image:Jx.aPixel.src,imageClass:"JustifyCenter",title:"Align Center",css:{"text-align":"center"},tags:["center"]},justifyfull:{image:Jx.aPixel.src,imageClass:"JustifyFull",title:"Align Full",css:{"text-align":"justify"}}}}});Jx.Plugin.Editor.Image=new Class({Family:"Jx.Plugin.Editor.Image",Extends:Jx.Plugin.Editor.Button,name:"image",options:{image:Jx.aPixel.src,imageClass:"Image",toggle:false,shortcut:"m",title:"Insert Image"},tags:["img"],action:"insertimage",command:function(){new Jx.Dialog.Prompt({prompt:"Enter the address of the image:",onClose:this.finish.bind(this)}).open()},finish:function(C,A,B){if(A.toLowerCase()==="ok"){this.editor.execute(this.action,false,B.trim())}}});Jx.Plugin.Editor.Indent=new Class({Family:"Jx.Plugin.Editor.Indent",Extends:Jx.Plugin.Editor.Button,name:"indent",options:{image:Jx.aPixel.src,imageClass:"Indent",toggle:false,title:"Indent"},tags:["blockquote"],action:"indent"});Jx.Plugin.Editor.Link=new Class({Family:"Jx.Plugin.Editor.Link",Extends:Jx.Plugin.Editor.Button,name:"createlink",options:{image:Jx.aPixel.src,imageClass:"Link",toggle:false,shortcut:"l",title:"Create Hyperlink"},tags:["a"],action:"createlink",command:function(){if(this.editor.selection.isCollapsed()){new Jx.Dialog.Message({message:"Please select the text you wish to hyperlink."}).open()}else{var A=this.editor.selection.getText();new Jx.Dialog.Prompt({prompt:'Enter the web address you wish to link to. <br/> The text you selected to link to: "'+A+'"',startingValue:"http://",onClose:this.finish.bind(this)}).open()}},finish:function(C,A,B){if(A.toLowerCase()==="ok"){this.editor.execute("createlink",false,B.trim())}}});Jx.Plugin.Editor.Orderedlist=new Class({Family:"Jx.Plugin.Editor.Orderedlist",Extends:Jx.Plugin.Editor.Button,name:"orderedlist",options:{image:Jx.aPixel.src,imageClass:"OrderedList",toggle:false,title:"Ordered List"},tags:["ol"],action:"insertorderedlist"});Jx.Plugin.Editor.Outdent=new Class({Family:"Jx.Plugin.Editor.Outdent",Extends:Jx.Plugin.Editor.Button,name:"outdent",options:{image:Jx.aPixel.src,imageClass:"Outdent",toggle:false,title:"Outdent"},action:"outdent"});Jx.Plugin.Editor.Redo=new Class({Family:"Jx.Plugin.Editor.Redo",Extends:Jx.Plugin.Editor.Button,name:"redo",options:{image:Jx.aPixel.src,imageClass:"Redo",toggle:false,shortcut:"y",title:"Redo"},action:"redo"});Jx.Plugin.Editor.Strikethrough=new Class({Family:"Jx.Plugin.Editor.Strikethrough",Extends:Jx.Plugin.Editor.Button,name:"strikethrough",options:{image:Jx.aPixel.src,imageClass:"Strikethrough",toggle:true,title:"Strike Through",shortcut:"s"},tags:["s","strike"],css:{"text-decoration":"line-through"},action:"strikethrough"});Jx.Plugin.Editor.Toggle=new Class({Family:"Jx.Plugin.Editor.Toggle",Extends:Jx.Plugin.Editor.Button,name:"toggle",options:{image:Jx.aPixel.src,imageClass:"ToggleView",toggle:true,title:"Toggle View"},command:function(){if(this.editor.mode=="textarea"){this.editor.enableToolbar()}else{this.editor.disableToolbar()}this.editor.toggleView()},setEnabled:$empty});Jx.Plugin.Editor.Undo=new Class({Family:"Jx.Plugin.Editor.Undo",Extends:Jx.Plugin.Editor.Button,name:"undo",options:{image:Jx.aPixel.src,imageClass:"Undo",toggle:false,shortcut:"z",title:"Undo"},action:"undo"});Jx.Plugin.Editor.Unlink=new Class({Family:"Jx.Plugin.Editor.Unlink",Extends:Jx.Plugin.Editor.Button,name:"unlink",options:{image:Jx.aPixel.src,imageClass:"Unlink",toggle:false,title:"Remove Hyperlink"},action:"unlink"});Jx.Plugin.Editor.Unorderedlist=new Class({Family:"Jx.Plugin.Editor.Unoderedlist",Extends:Jx.Plugin.Editor.Button,name:"unorderedlist",options:{image:Jx.aPixel.src,imageClass:"UnorderedList",toggle:false,title:"Unordered List"},tags:["ul"],action:"insertunorderedlist"});Jx.Plugin.Editor.CustomStyles=new Class({Family:"Jx.Plugin.Editor.CustomStyles",Extends:Jx.Plugin,rules:[],name:"customStyles",activeClass:"",attach:function(A){this.editor=A;this.parent(A);var B=this.editor.doc.styleSheets;$A(B).each(function(C){if(C.title=="jxEditorStylesheet"){this.parseStyles.delay(1000,this,C)}},this);this.placeholder=new Element("div",{html:"&nbsp;",width:10});this.editor.toolbar.add(this.placeholder)},detach:function(){this.button.destroy();this.parent(editor)},parseStyles:function(B){var D;if(Browser.Engine.trident){D=B.rules}else{try{D=B.cssRules}catch(C){console.log("couldn not get styles... waiting till they are available");this.parseStyles.delay(500,this,B);return }}$A(D).each(function(E){if(E.selectorText.test(/^\./)){this.rules.push(E.selectorText.slice(1))}},this);var A=[];A.push({value:"",text:"",selected:true});this.rules.each(function(E){A.push({value:E,text:E})},this);this.settingState=true;this.button=new Jx.Field.Select({comboOpts:A,label:"Choose a Style"});this.button.field.addEvent("change",this.command.bind(this));this.button.domObj.replaces(this.placeholder);this.editor.toolbar.update();this.settingState=false},checkState:function(A){if(!this.settingState){for(i=0;i<this.rules.length;i++){if(A.hasClass(this.rules[i])){this.settingState=true;this.button.setValue(this.rules[i]);this.settingState=false;return }}this.button.setValue("")}},command:function(){if(!this.settingState){var A=this.button.getValue();var B=this.editor.selection.getNode();if(A!==""){B.removeClass(this.activeClass);if(B.hasClass(A)){B.removeClass(A)}else{B.addClass(A)}this.activeClass=A}else{this.rules.each(function(C){if(B.hasClass(C)){B.removeClass(C)}},this)}}},setEnabled:function(A){if(A){this.button.enable()}else{this.button.disable()}}});Jx.Plugin.Editor.Block=new Class({Family:"Jx.Plugin.Editor.Block",Extends:Jx.Plugin,name:"block",tags:["p","div","h1","h2","h3","h4","h5","h6","pre","address"],action:"formatblock",attach:function(A){this.editor=A;this.parent(A);items=[{value:"",text:""}];this.tags.each(function(B){items.push({value:B,text:B})});this.button=new Jx.Field.Select({comboOpts:items,label:"Block Type"});this.button.field.addEvent("change",this.command.bind(this));this.editor.toolbar.add(this.button)},detach:function(){this.button.destroy();this.parent(editor)},checkState:function(B){this.setState(false);if($defined(this.tags)){var C=B;do{var A=C.tagName.toLowerCase();if(this.tags.contains(A)){this.setState(true,A);break}}while((C.tagName.toLowerCase()!="body")&&((C=Element.getParent(C))!=null))}},command:function(){if(!this.settingState){var A=this.button.getValue();if(A!==""){var B="<"+this.button.getValue()+">";this.editor.execute(this.action,false,B)}}},setEnabled:function(A){if(A){this.button.enable()}else{this.button.disable()}},setState:function(B,A){if(!B){A=""}this.button.setValue(A)}});