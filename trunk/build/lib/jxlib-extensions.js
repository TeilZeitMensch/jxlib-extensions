/******************************************************************************
 * JxLib-Extensions - A JxLib UI Extension Library, .1-alpha 
 * Copyright (c) 2008-2009, Sola Gratia Designs. All rights reserved.
 * MIT Style License
 *****************************************************************************/
Jx.Request=new Class({Extends:Jx.Object,requests:[],requestCount:0,loadingVisible:false,errorHandlers:null,processRequests:true,running:false,options:{debug:false,showLoading:{el:null,opts:{baseHref:"",img:{src:"/images/load.gif",styles:{width:16,height:16}}}},url:null,method:"get",type:"json",update:null,evalScripts:true,evalResponse:false,data:{}},init:function(A){var D=$merge(this.options,A);this.requestCount++;var C=new Hash({requestId:this.requestCount,options:D});D.data.requestId=C.get("requestId");var B=null;if(D.type==="json"){B=new Request.JSON({url:D.url,data:D.data,onSuccess:this.processSuccess.bind(this),onFailure:(function(E){this.failure(E,C.get("requestId"))}).bind(this)})}else{if(D.type==="html"){B=new Request.HTML({url:D.url,update:D.update,data:D.data,evalScripts:D.evalScripts,onSuccess:(function(G,E,H,F){this.success(C.get("requestId"),[G,E,H,F])}).bind(this),onFailure:(function(E){this.failure(E,C.get("requestId"))}).bind(this)})}else{B=new Request({url:D.url,data:D.data,evalResponse:D.evalResponse,onSuccess:(function(E,F){this.success(C.get("requestId"),[E,F])}).bind(this),onFailure:this.failure.bind(this)})}}C.combine({request:B});return C},failure:function(A,D){var C=this.getRequest(D);var B=C.get("options");this.removeMask(B);if($defined(B.events)&&$defined(B.events.onFailure)){B.events.onFailure.run(A)}this.running=false;this.run()},success:function(D,A){var C=this.getRequest(D);var B=C.get("options");this.removeMask(C);this.running=false;this.run();if($defined(B.events)&&$defined(B.events.onSuccess)){B.events.onSuccess.run(A)}},callServer:function(E,B,A,F){if(!$defined(A)){A="bottom"}F=$defined(F)?F:false;var G;if($defined(E)){var C=$type(E);if(C!=="hash"){G=new Hash(E)}else{G=E}}else{if($type(B)==="hash"){if(!B.has("data")){G=new Hash()}else{G=B.get("data")}}else{G=new Hash()}}var D;if($type(B)!=="hash"){B.data=G;D=this.init(B);D.set("data",G)}else{D=B}D.combine({data:G});if(A==="top"){this.requests.unshift(D)}else{this.requests.push(D)}if(!F){this.run()}return D.get("requestId")},run:function(B){B=($defined(B))?B:false;if((!this.running&&this.processRequests&&(this.requests.length>0))||B){this.running=true;var D=this.currentRequest=this.requests.shift();var C=D.get("options");if(C.showLoading.el&&!D.has("waiter")){var A=new Spinner(C.showLoading.el,C.showLoading.opts);A.start();D.set("waiter",A)}else{if(C.showLoading.el&&D.has("waiter")){D.get("waiter").start()}}D.get("request").send()}},runOne:function(){this.run(true)},processSuccess:function(D,G){if($defined(D)){var C=this.currentRequest;var A=C.get("options");this.removeMask();this.running=false;this.run();try{if(A.debug&&$defined(D.debug)){if($defined(A.events.onDebug)){A.events.onDebug.run(D.debug)}}if(D.success){if($defined(A.events.onSuccess)){A.events.onSuccess.run(D)}}else{if(!this.handleError(D,C,A)){if($defined(A.events.onError)){A.events.onError.run(D)}}}}catch(B){var F="Error occurred: "+B.message;F+="<br/>in "+B.fileName;F+="<br/>at line "+B.lineNumber;F+="<br/>Stack Trace:<br/>"+B.stack;if($defined(Jx.Dialog.Message)){var E=new Jx.Dialog.Message({message:F,width:700,height:400,resize:true});E.open()}else{alert(F)}}}else{console.log(G)}},getRequest:function(B){var A=null;this.requests.each(function(C){if(C.get("requestId")===B){A=C}},this);if($defined(A)){this.requests.erase(A)}return A},removeMask:function(){if(this.currentRequest.has("waiter")){var A=this.currentRequest.get("waiter");A.stop();this.currentRequest.erase("waiter")}},handleError:function(F,E,D){if($defined(this.errorHandlers)){if($defined(F.error)){var C=F.error.code;var B=F.error.message;if(this.errorHandlers.has(C)){var A=this.errorHandlers.get(C);A.run([B,E]);this.removeMask(D);return true}}}return false},addErrorHandler:function(B,A){if(!$defined(this.errorHandlers)){this.errorHandlers=new Hash()}this.errorHandlers.set(B,A)},stop:function(){this.processRequests=false},start:function(){this.processRequests=true;this.run()}});Jx.Manager=new Class({Family:"Jx.Manager",Implements:[Options,Events],options:{type:"generic"},list:null,count:0,initialize:function(A){this.setOptions(A);this.list=new Hash();window.addEvent("unload",this.destroyAll.bind(this))},register:function(A){if($defined(A.options.id)){id=A.options.id}else{id=this._genId()}this.list.include(id,A);return id},destroy:function(A){if(this.list.has(A)){el=this.list.get(A);if($defined(el.destroy)&&$type(el.destroy)==="function"){el.destroy()}this.list.erase(A)}},destroyAll:function(){this.list.each(function(B,A){this.destroy(A)},this)},get:function(A){if(this.list.has(A)){return this.list.get(A)}else{return null}},_genId:function(){this.count++;return"jx-"+this.options.type+"-"+this.count}});Jx.StoreMgr=new Jx.Manager({type:"store"});Jx.Preloader=new Class({Family:"Jx.Preloader",Implements:[Events,Options],options:{onProgress:$empty,onComplete:$empty},counter:0,loadedCounter:0,picHash:null,sources:null,initialize:function(A,B){this.setOptions(A);this.picHash=new Hash();this.sources=new Hash();B.each(function(C){this.add(C.key,C.source)},this)},add:function(A,B){this.counter++;this.sources.include(A,B)},imageComplete:function(){this.loadedCounter++;this.fireEvent("progress",[this.counter,this.loadedCounter]);if(this.counter==this.loadedCounter){this.fireEvent("complete",[this.picHash])}},start:function(){this.fireEvent("progress",[this.counter,this.loadedCounter]);this.sources.each(function(C,B){var A=new Asset.image(C,{onload:this.imageComplete.bind(this)});this.picHash.include(B,A)},this)}});Jx.Editor=new Class({Family:"Jx.Editor",Extends:Jx.Widget,options:{template:'<div class="jxEditor"><div class="jxEditorToolbar"></div><div class="jxEditorIframe"></div><textarea class="jxEditorTextarea"></textarea></div></div>',editorCssFile:null,html:'<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body></body></html>',content:null,plugins:[],cleanup:true,xhtml:true,semantics:true},classes:$H({domObj:"jxEditor",container:"jxEditorToolbar",iframe:"jxEditorIframe",textarea:"jxEditorTextarea"}),pluginNamespace:"Editor",blockEls:/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD)$/i,init:function(){this.parent()},mode:null,keys:{},editorDisabled:false,render:function(){this.parent();new Jx.Layout(this.domObj);this.toolbar=new Jx.Toolbar();this.toolbar.addTo(this.container);if(this.options.parent){this.addTo(this.options.parent)}this.domObj.resize();var C=this.iframe.getMarginBoxSize();var B=new IFrame({"class":"jxEditorIframe",src:'javascript:""',frameborder:0});B.replaces(this.iframe);this.iframe=B;this.mode="iframe";this.win=this.iframe.contentWindow;this.doc=this.win.document;this.doc.open();this.doc.close();if(!this.win.$family){new Window(this.win)}if(!this.doc.$family){new Document(this.doc)}document.id(this.doc.body);if($defined(this.options.editorCssFile)){var A=new Asset.css(this.options.editorCssFile,{title:"jxEditorStylesheet"});A.inject(this.doc.head)}if($defined(this.options.content)){this.doc.body.set("html",this.options.content);this.textarea.set("value",this.options.content)}if(Browser.Engine.trident){this.doc.body.contentEditable=true}else{this.doc.designMode="On"}this.selection=new Jx.Editor.Selection(this.win);this.doc.addEvents({mouseup:this.editorMouseUp.bindWithEvent(this),mousedown:this.editorStopEvent.bindWithEvent(this,"MouseDown"),mouseover:this.editorStopEvent.bindWithEvent(this,"MouseOver"),mouseout:this.editorStopEvent.bindWithEvent(this,"MouseOut"),mouseenter:this.editorMouseEnter.bindWithEvent(this),mouseleave:this.editorStopEvent.bindWithEvent(this,"MouseLeave"),contextmenu:this.editorStopEvent.bindWithEvent(this,"ContextMenu"),click:this.editorClick.bindWithEvent(this),dblclick:this.editorStopEvent.bindWithEvent(this,"DoubleClick"),keypress:this.editorKeyPress.bindWithEvent(this),keyup:this.editorKeyUp.bindWithEvent(this),keydown:this.editorKeyDown.bindWithEvent(this),focus:this.editorFocus.bindWithEvent(this),blur:this.editorBlur.bindWithEvent(this)});this.win.addEvents({focus:this.editorFocus.bindWithEvent(this),blur:this.editorBlur.bindWithEvent(this)});["cut","copy","paste"].each(function(D){this.doc.body.addListener(D,this.editorStopEvent.bindWithEvent(this,D.capitalize()))},this);this.textarea.addEvent("keypress",this.textarea.retrieve("jx:textareaKeyListener",this.keyListener.bind(this)));if(Browser.Engine.gecko&&Browser.Engine.version==18){this.doc.addEvent("focus",function(){this.win.fireEvent("focus").focus()}.bind(this))}this.oldContent=this.getContent();this.domObj.store("Jx.Editor",this);this.resize()},setContent:function(A){this.doc.body.set("html",A);return this},getContent:function(){return this.doc.body.get("html")},execute:function(C,B,A){if(this.busy){return }this.busy=true;this.doc.execCommand(C,B,A);this.saveContent();this.focus();this.busy=false;return false},toggleView:function(){this.fireEvent("preToggleView",this);if(this.mode==="textarea"){this.mode="iframe";this.iframe.setStyle("display","block");this.setContent(this.textarea.value);this.textarea.setStyle("display","none")}else{this.saveContent();this.mode="textarea";this.textarea.setStyle("display","block");this.iframe.setStyle("display","none")}this.fireEvent("postToggleView",this)},saveContent:function(){if(this.mode==="iframe"){this.textarea.set("value",this.cleanup(this.getContent()))}return this},resize:function(){var C=this.domObj.getContentBoxSize();var A=this.container.getMarginBoxSize();var B={width:C.width,height:C.height-A.height};this.iframe.setStyles(B);this.textarea.setStyles(B)},focus:function(){if(this.mode=="iframe"){this.win.focus()}else{this.textarea.focus()}this.fireEvent("focus",this);return this},editorStopEvent:function(B,A){if(this.editorDisabled){B.stop();return }this.fireEvent("editor"+A,[B,this])},editorFocus:function(A){this.oldContent="";this.fireEvent("editorFocus",[A,this])},editorBlur:function(A){this.oldContent=this.saveContent().getContent();this.fireEvent("editorBlur",[A,this])},editorMouseUp:function(A){if(this.editorDisabled){A.stop();return }this.checkStates();this.fireEvent("editorMouseUp",[A,this])},editorMouseEnter:function(A){if(this.editorDisabled){A.stop();return }if(this.oldContent&&this.getContent()!=this.oldContent){this.focus();this.fireEvent("editorPaste",[A,this])}this.fireEvent("editorMouseEnter",[A,this])},editorClick:function(B){if(Browser.Engine.webkit){var A=$(B.target);if(A.get("tag")=="img"){this.selection.selectNode(A)}}this.fireEvent("editorClick",[B,this])},editorKeyPress:function(A){if(this.editorDisabled){A.stop();return }this.keyListener(A);this.fireEvent("editorKeyPress",[A,this])},editorKeyUp:function(A){if(this.editorDisabled){A.stop();return }var B=A.code;if(/^enter|left|up|right|down|delete|backspace$/i.test(A.key)||(B>=33&&B<=36)||B==45||A.meta||A.control){if(Browser.Engines.trident4){$clear(this.checkStateDelay);this.checkStatesDelay=this.checkStates.delay(500,this)}else{this.checkStates()}}this.fireEvent("editorKeyUp",[A,this])},editorKeyDown:function(F){if(this.editorDisabled){F.stop();return }if(F.key=="enter"){if(F.shift&&Browser.Engine.webkit){var J=this.selection;var A=J.getRange();var I=this.doc.createElement("br");A.insertNode(I);A.setStartAfter(I);A.setEndAfter(I);J.setRange(A);if(J.getSelection().focusNode==I.previousSibling){var H=this.doc.createTextNode("\u00a0");var B=I.parentNode;var G=I.nextSibling;(G)?B.insertBefore(H,G):B.appendChild(H);J.selectNode(H);J.collapse(1)}this.win.scrollTo(0,Element.getOffsets(J.getRange().startContainer).y);F.preventDefault()}else{if(Browser.Engine.gecko||Browser.Engine.webkit){var D=this.selection.getNode();var C=D.getParents().include(D).some(function(K){return K.nodeName.test(this.blockEls)}.bind(this));if(!C){this.execute("insertparagraph",false,false)}}}}else{if(Browser.Engine.trident){var A=this.selection.getRange();var D=this.selection.getNode();if(A&&D.get("tag")!="li"){this.selection.insertContent("<br>");this.selection.collapse(false)}F.preventDefault()}}if(Browser.Engine.presto){var E=F.control||F.meta;if(E&&F.key=="x"){this.fireEvent("editorCut",[F,this])}else{if(E&&F.key=="c"){this.fireEvent("editorCopy",[F,this])}else{if((E&&F.key=="v")||(F.shift&&F.code==45)){this.fireEvent("editorPaste",[F,this])}}}}this.fireEvent("editorKeyDown",[F,this])},keyListener:function(C){var A=(Browser.Platform.mac)?C.meta:C.control;if(!A||!this.keys[C.key]){return }C.preventDefault();var B=this.keys[C.key];B.command();if(this.mode=="iframe"){this.checkStates()}},checkStates:function(){var A=this.selection.getNode();if(!A){return }if(Jx.type(A)!="element"){return }this.plugins.each(function(B){if($defined(B.checkState)){B.checkState(A)}},this)},cleanup:function(B){if(!this.options.cleanup){return B.trim()}do{var A=B;B=B.replace(/<br class\="webkit-block-placeholder">/gi,"<br />");B=B.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1");B=B.replace(/ class="Apple-style-span"/gi,"");B=B.replace(/<span style="">/gi,"");B=B.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>");B=B.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>");if(!this.options.semantics){B=B.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")}if(this.options.xhtml){B=B.replace(/<br>/gi,"<br />")}if(this.options.semantics){if(Browser.Engine.trident){B=B.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")}if(Browser.Engine.webkit){B=B.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>");B=B.replace(/<div>(.+?)<\/div>/ig,"<p>$1</p>")}if(["gecko","presto","webkit"].contains(Browser.Engine.name)){B=B.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>");B=B.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")}B=B.replace(/<br[^>]*><\/p>/g,"</p>");B=B.replace(/<p>\s*(<img[^>]+>)\s*<\/p>/ig,"$1\n");B=B.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n");B=B.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n");B=B.replace(/><li>/g,">\n\t<li>");B=B.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>");B=B.replace(/([^\n])<img/ig,"$1\n<img");B=B.replace(/^\s*$/g,"")}B=B.replace(/<br ?\/?>$/gi,"");B=B.replace(/^<br ?\/?>/gi,"");B=B.replace(/><br ?\/?>/gi,">");B=B.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1");B=B.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>");B=B.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>");B=B.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");B=B.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");B=B.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>');B=B.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1");B=B.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1");B=B.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1");B=B.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1");B=B.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1");B=B.replace(/<[^> ]*/g,function(C){return C.toLowerCase()});B=B.replace(/<[^>]*>/g,function(C){C=C.replace(/ [^=]+=/g,function(D){return D.toLowerCase()});return C});B=B.replace(/<[^>]*>/g,function(C){C=C.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return C});if(this.options.xhtml){B=B.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")}B=B.replace(/<p>(?:\s*)<p>/g,"<p>");B=B.replace(/<\/p>\s*<\/p>/g,"</p>");B=B.replace(/<pre[^>]*>.*?<\/pre>/gi,function(C){return C.replace(/<br ?\/?>/gi,"\n")});B=B.trim()}while(B!=A);return B},enableToolbar:function(){this.plugins.each(function(A){A.setEnabled(true)},this)},disableToolbar:function(){this.plugins.each(function(A){A.setEnabled(false)},this)}});Jx.Editor.Selection=new Class({Family:"Jx.Editor.Selection",Extends:Jx.Object,parameters:["win","options"],options:{},init:function(){this.parent();this.win=this.options.win},getSelection:function(){this.win.focus();return(this.win.getSelection)?this.win.getSelection():this.win.document.selection},getRange:function(){var A=this.getSelection();if(!A){return null}try{return A.rangeCount>0?A.getRangeAt(0):(A.createRange?A.createRange():null)}catch(B){return this.doc.body.createTextRange()}},setRange:function(A){if(A.select){$try(function(){A.select()})}else{var B=this.getSelection();if(B.addRange){B.removeAllRanges();B.addRange(A)}}},selectNode:function(C,D){var B=this.getRange();var A=this.getSelection();if(B.moveToElementText){$try(function(){B.moveToElementText(C);B.select()})}else{if(A.addRange){D?B.selectNodeContents(C):B.selectNode(C);A.removeAllRanges();A.addRange(B)}else{A.setBaseAndExtent(C,0,C,1)}}return C},isCollapsed:function(){var A=this.getRange();if(A.item){return false}return A.boundingWidth==0||this.getSelection().isCollapsed},collapse:function(A){var C=this.getRange();var B=this.getSelection();if(C.select){C.collapse(A);C.select()}else{A?B.collapseToStart():B.collapseToEnd()}},getContent:function(){var C=this.getRange();var A=new Element("body");if(this.isCollapsed()){return""}if(C.cloneContents){A.appendChild(C.cloneContents())}else{if($defined(C.item)||$defined(C.htmlText)){A.set("html",C.item?C.item(0).outerHTML:C.htmlText)}else{A.set("html",C.toString())}}var B=A.get("html");return B},getText:function(){var B=this.getRange();var A=this.getSelection();return this.isCollapsed()?"":B.text||(A.toString?A.toString():"")},getNode:function(){var B=this.getRange();if(!Browser.Engine.trident){var A=null;if(B){A=B.commonAncestorContainer;if(!B.collapsed){if(B.startContainer==B.endContainer){if(B.startOffset-B.endOffset<2){if(B.startContainer.hasChildNodes()){A=B.startContainer.childNodes[B.startOffset]}}}}while($type(A)!="element"){A=A.parentNode}}return document.id(A)}return document.id(B.item?B.item(0):B.parentElement())},insertContent:function(B){if(Browser.Engine.trident){var A=this.getRange();A.pasteHTML(B);A.collapse(false);A.select()}else{this.win.document.execCommand("insertHTML",false,B)}}});Jx.Plugin.Editor={};Jx.Plugin.Editor.Button=new Class({Family:"Jx.Plugin.Editor.Button",Extends:Jx.Plugin,options:{image:"",toggle:false,shortcut:null,title:null,imageClass:"",prefix:"jxEditorButton"},tags:null,css:null,action:null,attach:function(A){this.editor=A;this.selection=A.selection;this.parent(A);this.button=new Jx.Button({toggle:this.options.toggle,image:this.options.image,imageClass:this.options.prefix+this.options.imageClass,tooltip:this.options.title+($defined(this.options.shortcut)?"(ctrl-"+this.options.shortcut+")":"")});this.editor.toolbar.add(this.button);if(this.options.toggle){this.button.addEvents({down:this.command.bind(this),up:this.command.bind(this)})}else{this.button.addEvent("click",this.command.bind(this))}this.editor.keys[this.options.shortcut]=this},detach:function(){this.button.destroy();this.parent(editor)},setState:function(A){if(this.options.toggle){this.settingState=true;this.button.setActive(A)}this.settingState=false},getState:function(){if(this.options.toggle){return this.button.isActive()}return false},checkState:function(C){this.setState(false);if($defined(this.action)){try{if(this.editor.doc.queryCommandState(this.action)){this.setState(true);return }}catch(E){}}if($defined(this.tags)){var D=C;do{var A=D.tagName.toLowerCase();if(this.tags.contains(A)){this.setState(true);break}}while((D.tagName.toLowerCase()!="body")&&((D=Element.getParent(D))!=null))}if($defined(this.css)){var D=C;do{found=false;for(var F in this.css){var B=this.css[F];if(Element.getStyle(D,F).contains(B)){this.setState(true);found=true}}if(found||D.tagName.test(this.editor.blockEls)){break}}while((D.tagName.toLowerCase()!="body")&&((D=Element.getParent(D))!=null))}},command:function(){if(!this.settingState){this.editor.execute(this.action,false,false)}},setEnabled:function(A){this.button.setEnabled(A)}});Jx.Plugin.Editor.Bold=new Class({Family:"Jx.Plugin.Editor.Bold",Extends:Jx.Plugin.Editor.Button,name:"bold",options:{image:Jx.aPixel.src,imageClass:"Bold",toggle:true,shortcut:"b",title:"Bold"},tags:["b","strong"],css:{"font-weight":"bold"},action:"bold",init:function(){this.parent();this.bound={setup:this.setup.bind(this),parse:this.setup.bind(this)}},attach:function(A){this.parent(A);this.editor.addEvent("preToggleView",this.bound.parse);this.editor.addEvent("postPluginInit",this.bound.setup)},setup:function(){var A=this.parse();if(A){this.editor.setContent(A)}this.editor.removeEvent("postPluginInit",this.bound.setup)},parse:function(){if(Browser.Engine.gecko){var A=this.editor.textarea.get("value");A.replace(/<strong([^>]*)>/gi,"<b$1>");A.replace(/<\/strong>/gi,"</b>");this.editor.textarea.set("html",A);return A}return null}});Jx.Plugin.Editor.Italic=new Class({Family:"Jx.Plugin.Editor.Italic",Extends:Jx.Plugin.Editor.Button,name:"italic",options:{image:Jx.aPixel.src,imageClass:"Italic",toggle:true,shortcut:"i",title:"Italic"},tags:["i","em"],css:{"font-style":"italic"},action:"italic",init:function(){this.parent();this.bound={setup:this.setup.bind(this),parse:this.setup.bind(this)}},attach:function(A){this.parent(A);this.editor.addEvent("preToggleView",this.bound.parse);this.editor.addEvent("postPluginInit",this.bound.setup)},setup:function(){var A=this.parse();if(A){this.editor.setContent(A)}this.editor.removeEvent("postPluginInit",this.bound.setup)},parse:function(){if(Browser.Engine.gecko){var A=this.editor.textarea.get("value").replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");this.editor.textarea.set("value",A);return A}return null}});Jx.Plugin.Editor.Underline=new Class({Family:"Jx.Plugin.Editor.Underline",Extends:Jx.Plugin.Editor.Button,name:"underline",options:{image:Jx.aPixel.src,imageClass:"Underline",toggle:true,shortcut:"u",title:"Underline"},tags:["u"],css:{"text-decoration":"underline"},action:"underline"});Jx.Plugin.Editor.Separator=new Class({Family:"Jx.Plugin.Editor.Separator",Extends:Jx.Plugin,name:"separator",attach:function(A){this.button=new Jx.Toolbar.Separator();A.toolbar.add(this.button)}});Jx.Plugin.Editor.ButtonSet=new Class({Family:"Jx.Plugin.Editor.ButtonSet",Extends:Jx.Plugin,options:{buttons:null},buttonSet:null,buttons:[],prefix:"jxEditorButton",init:function(){this.parent();this.buttonSet=new Jx.ButtonSet()},attach:function(A){this.parent(A);this.editor=A;$H(this.options.buttons).each(function(B,D){var C=new Jx.Button({toggle:true,image:B.image,imageClass:this.prefix+B.imageClass,tooltip:B.title});this.editor.toolbar.add(C);this.buttons.push(C);this.buttonSet.add(C);C.action=D;C.addEvents({down:this.command.bind(this,D),up:this.command.bind(this,D)})},this)},detach:function(){this.parent()},checkState:function(A){this.buttons.each(function(D){this.setState(false,D);if($defined(D.action)){try{if(this.editor.doc.queryCommandState(D.action)){this.setState(true,D);return }}catch(F){}}if($defined(D.options.tags)){var E=A;do{var B=E.tagName.toLowerCase();if(D.options.tags.contains(B)){this.setState(true,D);break}}while((E=Element.getParent(E))!=null)}if($defined(D.options.css)){var E=A;do{found=false;for(var G in D.options.css){var C=D.options.css[G];if(Element.getStyle(E,G).contains(C)){this.setState(true,D);found=true}}if(found||E.tagName.test(this.editor.blockEls)){break}}while((E=A.getParent(E))!=null)}},this)},setState:function(B,A){this.settingState=true;A.setActive(B);this.settingState=false},command:function(A){if(!this.settingState){this.editor.execute(A,false,false)}},setEnabled:function(A){this.buttons.each(function(B){B.setEnabled(A)},this)}});Jx.Plugin.Editor.Alignment=new Class({Family:"Jx.Plugin.Editor.Aligmment",Extends:Jx.Plugin.Editor.ButtonSet,name:"alignment",options:{buttons:{justifyleft:{image:Jx.aPixel.src,imageClass:"JustifyLeft",title:"Align Left",css:{"text-align":"left"}},justifyright:{image:Jx.aPixel.src,imageClass:"JustifyRight",title:"Align Right",css:{"text-align":"right"}},justifycenter:{image:Jx.aPixel.src,imageClass:"JustifyCenter",title:"Align Center",css:{"text-align":"center"},tags:["center"]},justifyfull:{image:Jx.aPixel.src,imageClass:"JustifyFull",title:"Align Full",css:{"text-align":"justify"}}}}});Jx.Plugin.Editor.Image=new Class({Family:"Jx.Plugin.Editor.Image",Extends:Jx.Plugin.Editor.Button,name:"image",options:{image:Jx.aPixel.src,imageClass:"Image",toggle:false,shortcut:"m",title:"Insert Image"},tags:["img"],action:"insertimage",command:function(){new Jx.Dialog.Prompt({prompt:"Enter the address of the image:",onClose:this.finish.bind(this)}).open()},finish:function(C,A,B){if(A.toLowerCase()==="ok"){this.editor.execute(this.action,false,B.trim())}}});Jx.Plugin.Editor.Indent=new Class({Family:"Jx.Plugin.Editor.Indent",Extends:Jx.Plugin.Editor.Button,name:"indent",options:{image:Jx.aPixel.src,imageClass:"Indent",toggle:false,title:"Indent"},tags:["blockquote"],action:"indent"});Jx.Plugin.Editor.Link=new Class({Family:"Jx.Plugin.Editor.Link",Extends:Jx.Plugin.Editor.Button,name:"createlink",options:{image:Jx.aPixel.src,imageClass:"Link",toggle:false,shortcut:"l",title:"Create Hyperlink"},tags:["a"],action:"createlink",command:function(){if(this.editor.selection.isCollapsed()){new Jx.Dialog.Message({message:"Please select the text you wish to hyperlink."}).open()}else{var A=this.editor.selection.getText();new Jx.Dialog.Prompt({prompt:'Enter the web address you wish to link to. <br/> The text you selected to link to: "'+A+'"',startingValue:"http://",onClose:this.finish.bind(this)}).open()}},finish:function(C,A,B){if(A.toLowerCase()==="ok"){this.editor.execute("createlink",false,B.trim())}}});Jx.Plugin.Editor.Orderedlist=new Class({Family:"Jx.Plugin.Editor.Orderedlist",Extends:Jx.Plugin.Editor.Button,name:"orderedlist",options:{image:Jx.aPixel.src,imageClass:"OrderedList",toggle:false,title:"Ordered List"},tags:["ol"],action:"insertorderedlist"});Jx.Plugin.Editor.Outdent=new Class({Family:"Jx.Plugin.Editor.Outdent",Extends:Jx.Plugin.Editor.Button,name:"outdent",options:{image:Jx.aPixel.src,imageClass:"Outdent",toggle:false,title:"Outdent"},action:"outdent"});Jx.Plugin.Editor.Redo=new Class({Family:"Jx.Plugin.Editor.Redo",Extends:Jx.Plugin.Editor.Button,name:"redo",options:{image:Jx.aPixel.src,imageClass:"Redo",toggle:false,shortcut:"y",title:"Redo"},action:"redo"});Jx.Plugin.Editor.Strikethrough=new Class({Family:"Jx.Plugin.Editor.Strikethrough",Extends:Jx.Plugin.Editor.Button,name:"strikethrough",options:{image:Jx.aPixel.src,imageClass:"Strikethrough",toggle:true,title:"Strike Through",shortcut:"s"},tags:["s","strike"],css:{"text-decoration":"line-through"},action:"strikethrough"});Jx.Plugin.Editor.Toggle=new Class({Family:"Jx.Plugin.Editor.Toggle",Extends:Jx.Plugin.Editor.Button,name:"toggle",options:{image:Jx.aPixel.src,imageClass:"ToggleView",toggle:true,title:"Toggle View"},command:function(){if(this.editor.mode=="textarea"){this.editor.enableToolbar()}else{this.editor.disableToolbar()}this.editor.toggleView()},setEnabled:$empty});Jx.Plugin.Editor.Undo=new Class({Family:"Jx.Plugin.Editor.Undo",Extends:Jx.Plugin.Editor.Button,name:"undo",options:{image:Jx.aPixel.src,imageClass:"Undo",toggle:false,shortcut:"z",title:"Undo"},action:"undo"});Jx.Plugin.Editor.Unlink=new Class({Family:"Jx.Plugin.Editor.Unlink",Extends:Jx.Plugin.Editor.Button,name:"unlink",options:{image:Jx.aPixel.src,imageClass:"Unlink",toggle:false,title:"Remove Hyperlink"},action:"unlink"});Jx.Plugin.Editor.Unorderedlist=new Class({Family:"Jx.Plugin.Editor.Unoderedlist",Extends:Jx.Plugin.Editor.Button,name:"unorderedlist",options:{image:Jx.aPixel.src,imageClass:"UnorderedList",toggle:false,title:"Unordered List"},tags:["ul"],action:"insertunorderedlist"});Jx.Plugin.Editor.CustomStyles=new Class({Family:"Jx.Plugin.Editor.CustomStyles",Extends:Jx.Plugin,rules:[],name:"customStyles",activeClass:"",attach:function(A){this.editor=A;this.parent(A);var B=this.editor.doc.styleSheets;$A(B).each(function(C){if(C.title=="jxEditorStylesheet"){this.parseStyles.delay(1000,this,C)}},this);this.placeholder=new Element("div",{html:"&nbsp;",width:10});this.editor.toolbar.add(this.placeholder)},detach:function(){this.button.destroy();this.parent(editor)},parseStyles:function(B){var C;if(Browser.Engine.trident){C=B.rules}else{C=B.cssRules}$A(C).each(function(D){if(D.selectorText.test(/^\./)){this.rules.push(D.selectorText.slice(1))}},this);var A=[];A.push({value:"",text:"",selected:true});this.rules.each(function(D){A.push({value:D,text:D})},this);this.settingState=true;this.button=new Jx.Field.Select({comboOpts:A,label:"Choose a Style"});this.button.field.addEvent("change",this.command.bind(this));this.button.domObj.replaces(this.placeholder);this.editor.toolbar.update();this.settingState=false},checkState:function(A){if(!this.settingState){for(i=0;i<this.rules.length;i++){if(A.hasClass(this.rules[i])){this.settingState=true;this.button.setValue(this.rules[i]);this.settingState=false;return }}this.button.setValue("")}},command:function(){if(!this.settingState){var A=this.button.getValue();var B=this.editor.selection.getNode();if(A!==""){B.removeClass(this.activeClass);if(B.hasClass(A)){B.removeClass(A)}else{B.addClass(A)}this.activeClass=A}else{this.rules.each(function(C){if(B.hasClass(C)){B.removeClass(C)}},this)}}},setEnabled:function(A){if(A){this.button.enable()}else{this.button.disable()}}});